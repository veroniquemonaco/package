{% extends 'base.html.twig' %}

{% block body %}

    <div class="container container-bloc-home">

        <div class="package-front">


            <h1>Il est temps de préparer votre paquetage</h1>


            <div id="accordion" role="tablist" aria-multiselectable="true">

                <div class="card">
                    <div class="card-header" role="tab" id="headingTwo">
                        <h5 class="mb-0">
                            <a class="collapsed" data-toggle="collapse" data-parent="#accordion" href="#collapseTwo"
                               aria-expanded="false" aria-controls="collapseTwo">
                                Pantalons
                            </a>
                        </h5>
                    </div>

                    <div id="collapseTwo" class="collapse" role="tabpanel" aria-labelledby="headingTwo">
                        <div class="card-block">

                            <table class="table table-striped">
                                <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Libellé</th>
                                    <th>Taille</th>
                                    <th>Quantité</th>
                                    <th>OK</th>
                                </tr>
                                </thead>
                                <tbody>
                                {% for produit in produits %}
                                    {% if produit.category.name == 'Pantalon' %}

                                        <tr>
                                            <th scope="row">1</th>
                                            <td class="form-product" data-productid="{{ produit.id }}">
                                                {{ produit.name }}</td>
                                            <td class="form-product-taille">
                                                <select class="custom-select">
                                                    {#<option>tailles</option>#}
                                                    {% for taille in produit.tailles %}
                                                        <option class="form-product-taille-option"
                                                                value="{{ taille.id }}">{{ taille.name }}</option>
                                                    {% endfor %}
                                                </select>
                                            </td>
                                            <td class="form-product-qty">
                                                <input type="number" class="form-product-qty-value form-group"
                                                       id="quantity">
                                            </td>
                                            <td>
                                                <div class="custom-control custom-checkbox">
                                                    <input type="checkbox" class="form-product-check" id="customCheck1">
                                                    <label class="custom-control-label" for="customCheck1">Check this
                                                        custom checkbox</label>
                                                </div>
                                            </td>
                                        </tr>

                                    {% endif %}
                                {% endfor %}
                                </tbody>
                            </table>

                        </div>
                    </div>
                </div>

            </div>

            <div id="panier">
                <h6>Vous avez choisi ces vêtements</h6>
                <table class="table">
                    <thead>
                    <tr>
                        <th scope="col">#</th>
                        <th scope="col">Produit</th>
                        <th scope="col">Taille</th>
                        <th scope="col">Qté</th>
                    </tr>
                    </thead>
                    <tbody class="panier--product">
                    </tbody>
                </table>

            </div>

        </div>
    </div>


{% endblock %}

{% block javascripts %}
    {{ parent() }}

    <script type="text/javascript">
        $(document).ready(function () {
            let addProduct = {
                idPdt: null,
                taille: null,
                qty: null
            };
            let cart;
            // productname.each(function(index) {
            //     var productid = $(this).data('productid');
            //     array.push(productid);
            // });
            $(".form-product-check").change(function () {
                let isChecked = $(this).is(":checked");
                if (isChecked) {
                    addProduct.idPdt = $(this).parent().parent().parent().children('td.form-product').data('productid');
                    addProduct.qty = $(this).parent().parent().parent().children('td.form-product-qty')
                        .children('input#quantity').val();
                    addProduct.taille = $(this).parent().parent().parent().children('td.form-product-taille')
                        .children('select.custom-select').val();
                    console.log(addProduct);
                    console.log(cart);
                    $.ajax({
                        url: '{{ path('package') }}',
                        type: 'POST',
                        dataType: 'json',
                        data: {'addProduct': addProduct, 'cart': cart},
                        success: function (data) {
                            console.log(data);
                            console.log(data['cart']);
                            let cart = data['cart'];
                            let idPdtCart = data['addPdtId'];
                            let qtyCart = data['addPdtQty'];
                            let tailleCart = data['addPdtTaille'];
                            let libellePdtCart = data['addPdtLibelle'].replace(/"/g, "");
                            let libelleTailleCart = data['addPdtTailleLibelle'].replace(/"/g, "");
                            console.log(libellePdtCart);
                            $('.panier--product').append("<tr><th scope=\"row\">2</th>\n" +
                                "                        <td>" + libellePdtCart + "</td>\n" +
                                "                        <td>" + libelleTailleCart + "</td>\n" +
                                "                        <td>" + qtyCart  + "</td>\n" +
                                "                    </tr>");
                        }
                    })
                }
            });

        });

    </script>

{% endblock %}